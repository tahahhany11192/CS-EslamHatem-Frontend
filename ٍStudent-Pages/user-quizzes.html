<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Quizzes - CS-IslamHatem</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&family=Exo+2:wght@300;400;600&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #0066ff;
      --secondary: #00ccff;
      --accent: #ff00cc;
      --dark: #0a1128;
      --light: #f0f6ff;
      --gradient: linear-gradient(135deg, var(--primary), var(--secondary));
      --gradient-accent: linear-gradient(135deg, var(--primary), var(--accent));
      --card-bg: rgba(255, 255, 255, 0.05);
      --sidebar-width: 260px;
      --header-height: 70px;
      --bottom-nav-height: 70px;
      --border-radius: 16px;
      --transition: all 0.3s ease;
      
      /* Grade colors */
      --grade-high: #4ade80;
      --grade-medium: #fbbf24;
      --grade-low: #f87171;
      --grade-na: #94a3b8;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Exo 2', sans-serif;
      background-color: var(--dark);
      color: var(--light);
      overflow-x: hidden;
      background-image: 
        radial-gradient(circle at 10% 20%, rgba(0, 102, 255, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 90% 60%, rgba(0, 204, 255, 0.1) 0%, transparent 20%),
        radial-gradient(circle at 50% 80%, rgba(255, 0, 204, 0.1) 0%, transparent 20%);
      min-height: 100vh;
    }

    /* Layout */
    .dashboard-container {
      display: flex;
      min-height: 100vh;
    }

    /* Overlay for mobile */
    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      backdrop-filter: blur(5px);
      z-index: 99;
      display: none;
    }

    /* Sidebar - Desktop */
    .sidebar {
      width: 277px;
      background: rgba(10, 17, 40, 0.9);
      backdrop-filter: blur(10px);
      border-right: 1px solid rgba(0, 204, 255, 0.2);
      padding: 20px 0;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      z-index: 100;
      transition: var(--transition);
    }

    .sidebar-header {
      padding: 0 20px 20px;
      border-bottom: 1px solid rgba(0, 204, 255, 0.1);
      margin-bottom: 20px;
    }

    .sidebar-logo {
      font-family: 'Orbitron', sans-serif;
      font-weight: 700;
      font-size: 1.4rem;
      color: var(--light);
      text-decoration: none;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .sidebar-logo span {
      color: var(--secondary);
    }

    .nav-menu {
      list-style: none;
      padding: 0;
    }

    .nav-item {
      margin-bottom: 5px;
    }

    .nav-link {
      display: flex;
      align-items: center;
      padding: 15px 20px;
      color: rgba(240, 246, 255, 0.7);
      text-decoration: none;
      transition: var(--transition);
      border-left: 4px solid transparent;
    }

    .nav-link:hover, .nav-link.active {
      background: rgba(0, 102, 255, 0.1);
      color: var(--light);
      border-left-color: var(--primary);
    }

    .nav-link i {
      margin-right: 15px;
      font-size: 1.2rem;
      width: 24px;
      text-align: center;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: var(--sidebar-width);
      padding: 20px;
      padding-bottom: calc(var(--bottom-nav-height) + 20px);
      transition: var(--transition);
    }

    /* Header - Mobile & Desktop */
    .header {
      background: rgba(10, 17, 40, 0.8);
      backdrop-filter: blur(10px);
      padding: 15px 20px;
      border-radius: var(--border-radius);
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
    }

    .welcome-section h1 {
      font-family: 'Exo 2', sans-serif;
      font-size: 1.5rem;
      font-weight: 600;
      margin-bottom: 5px;
    }

    .welcome-section p {
      color: rgba(240, 246, 255, 0.7);
      font-size: 0.9rem;
    }

    .user-profile {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .profile-img {
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: var(--gradient);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.2rem;
    }

    /* Page Title */
    .page-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 2rem;
      margin-bottom: 10px;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .page-subtitle {
      color: rgba(240, 246, 255, 0.7);
      margin-bottom: 30px;
      font-size: 1.1rem;
    }

    /* Stats Cards */
    .stats-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .stat-card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 20px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 204, 255, 0.1);
      text-align: center;
      transition: var(--transition);
    }

    .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
    }

    .stat-number {
      font-size: 2.5rem;
      font-weight: 700;
      margin-bottom: 10px;
    }

    .stat-label {
      color: rgba(240, 246, 255, 0.7);
      font-size: 0.9rem;
    }

    .stat-pending { color: #fbbf24; }
    .stat-completed { color: #4ade80; }
    .stat-graded { color: #6a5af9; }

    /* Progress bar */
    .progress-container {
      margin-top: 15px;
      margin-bottom: 30px;
    }

    .progress-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 5px;
      font-size: 0.9rem;
      color: rgba(240, 246, 255, 0.7);
    }

    .progress-bar {
      height: 12px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 10px;
      overflow: hidden;
      position: relative;
    }

    .progress-fill {
      height: 100%;
      background: var(--gradient);
      border-radius: 10px;
      transition: width 0.5s ease;
      box-shadow: 0 0 10px rgba(0, 102, 255, 0.5);
    }

    /* Quiz Cards */
    .quizzes-container {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
    }

    .quiz-card {
      background: var(--card-bg);
      border-radius: var(--border-radius);
      padding: 20px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(0, 204, 255, 0.1);
      transition: var(--transition);
      position: relative;
    }

    .quiz-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
      border-color: rgba(0, 204, 255, 0.3);
    }

    .quiz-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }

    .quiz-title {
      font-size: 1.2rem;
      font-weight: 600;
      color: var(--light);
      margin-bottom: 10px;
    }

    .quiz-desc {
      color: rgba(240, 246, 255, 0.7);
      margin-bottom: 15px;
      line-height: 1.5;
    }

    .quiz-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 15px;
      color: rgba(240, 246, 255, 0.6);
      font-size: 0.9rem;
    }

    .meta-item {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    /* Status badges */
    .status-badge {
      padding: 5px 10px;
      border-radius: 50px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .status-pending {
      background: rgba(251, 191, 36, 0.2);
      color: #fbbf24;
    }

    .status-completed {
      background: rgba(74, 222, 128, 0.2);
      color: #4ade80;
    }

    .status-graded {
      background: rgba(106, 90, 249, 0.2);
      color: #6a5af9;
    }

    /* Grade Display Styles */
    .grade-display {
      margin-top: 15px;
      padding: 12px;
      border-radius: 10px;
      background: rgba(0, 0, 0, 0.2);
      text-align: center;
    }

    .grade-value {
      font-family: 'Montserrat', sans-serif;
      font-weight: 800;
      font-size: 2.5rem;
      text-shadow: 0 0 10px rgba(255 204 0 / 79%);
    }

    .grade-high {
      color: var(--grade-high);
      background: linear-gradient(135deg, rgba(74, 222, 128, 0.15), transparent);
    }

    .grade-medium {
      color: var(--grade-medium);
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.15), transparent);
    }

    .grade-low {
      color: var(--grade-low);
      background: linear-gradient(135deg, rgba(248, 113, 113, 0.15), transparent);
    }

    .grade-na {
      color: var(--grade-na);
      background: linear-gradient(135deg, rgba(148, 163, 184, 0.15), transparent);
    }

    .grade-label {
      font-size: 0.9rem;
      color: rgba(240, 246, 255, 0.7);
      margin-top: 5px;
    }

    /* Timer Styles - FIXED POSITIONING */
    .timer-container {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(10, 17, 40, 0.95);
      padding: 15px 20px;
      border-radius: 12px;
      z-index: 2000;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(0, 204, 255, 0.3);
      display: none;
      backdrop-filter: blur(10px);
      min-width: 140px;
      text-align: center;
    }

    .timer-title {
      font-size: 0.9rem;
      color: rgba(240, 246, 255, 0.7);
      margin-bottom: 5px;
      font-weight: 600;
    }

    .timer-display {
      font-family: 'Orbitron', monospace;
      font-size: 1.8rem;
      font-weight: 700;
      text-align: center;
      letter-spacing: 1px;
    }

    .timer-normal {
      color: #4ade80;
      text-shadow: 0 0 8px rgba(74, 222, 128, 0.5);
    }

    .timer-warning {
      color: #fbbf24;
      text-shadow: 0 0 8px rgba(251, 191, 36, 0.5);
      animation: pulse 1s infinite;
    }

    .timer-danger {
      color: #f87171;
      text-shadow: 0 0 8px rgba(248, 113, 113, 0.5);
      animation: pulse 0.5s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.7; }
      100% { opacity: 1; }
    }

    /* Buttons */
    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 30px;
      font-family: 'Exo 2', sans-serif;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }

    .btn-primary {
      background: var(--gradient);
      color: white;
      box-shadow: 0 4px 15px rgba(0, 102, 255, 0.3);
    }

    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 102, 255, 0.4);
    }

    .btn-secondary {
      background: transparent;
      color: var(--secondary);
      border: 2px solid var(--secondary);
    }

    .btn-secondary:hover {
      background: rgba(0, 204, 255, 0.1);
    }

    .btn-disabled {
      background: rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.5);
      cursor: not-allowed;
    }

    .btn-disabled:hover {
      transform: none;
      box-shadow: none;
    }

    /* Exam Modal */
    .exam-modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(10, 17, 40, 0.95);
      backdrop-filter: blur(10px);
      z-index: 1000;
      display: flex;
      justify-content: center;
      align-items: center;
      opacity: 0;
      visibility: hidden;
      transition: var(--transition);
    }

    .exam-modal.active {
      opacity: 1;
      visibility: visible;
    }

    .exam-container {
      background: var(--card-bg);
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      border-radius: var(--border-radius);
      padding: 20px;
      border: 1px solid rgba(0, 204, 255, 0.2);
      overflow-y: auto;
      position: relative;
      z-index: 1001;
    }

    .exam-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid rgba(0, 204, 255, 0.1);
    }

    .exam-title {
      font-family: 'Orbitron', sans-serif;
      font-size: 1.5rem;
      background: var(--gradient);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }

    .close-exam {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      color: var(--light);
      font-size: 1.5rem;
      cursor: pointer;
      z-index: 10;
    }

    /* Structured Quiz in Modal */
    .structured-container {
      background: rgba(0, 0, 0, 0.2);
      padding: 20px;
      border-radius: var(--border-radius);
      margin-bottom: 20px;
    }

    .question {
      margin-bottom: 20px;
      padding: 15px;
      border: 1px solid rgba(0, 204, 255, 0.1);
      border-radius: var(--border-radius);
      background: rgba(0, 0, 0, 0.1);
    }

    .question label {
      display: block;
      font-weight: bold;
      margin-bottom: 8px;
      color: var(--light);
    }

    textarea {
      width: 100%;
      height: 80px;
      padding: 8px;
      border-radius: 4px;
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(0, 204, 255, 0.2);
      color: var(--light);
      font-family: 'Exo 2', sans-serif;
    }

    textarea:focus {
      outline: none;
      border-color: var(--secondary);
    }

    .options label {
      display: block;
      margin: 5px 0;
      color: rgba(240, 246, 255, 0.8);
    }

    .options input[type="radio"] {
      margin-right: 10px;
    }

    .btn-submit {
      display: block;
      width: 100%;
      padding: 12px;
      font-size: 16px;
      background: var(--gradient);
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      transition: var(--transition);
      margin-top: 20px;
    }

    .btn-submit:hover {
      box-shadow: 0 8px 20px rgba(0, 102, 255, 0.4);
    }

    .status {
      margin-top: 15px;
      font-weight: bold;
      text-align: center;
      color: var(--light);
    }

    /* PDF Quiz in Modal */
    .pdf-container {
      background: rgba(0, 0, 0, 0.2);
      padding: 20px;
      border-radius: var(--border-radius);
      margin-bottom: 20px;
    }

    .download-btn {
      display: inline-block; 
      margin-top: 15px; 
      padding: 10px 15px;
      background: var(--gradient); 
      color: white; 
      border-radius: 5px; 
      text-decoration: none;
      transition: var(--transition);
    }

    .download-btn:hover { 
      box-shadow: 0 8px 20px rgba(0, 102, 255, 0.4);
      transform: translateY(-2px);
    }

    .btn-pdf-upload {
      padding: 10px 15px; 
      background: var(--gradient); 
      color: #fff; 
      border: none; 
      border-radius: 5px; 
      cursor: pointer; 
      transition: var(--transition);
    }

    .btn-pdf-upload:hover { 
      box-shadow: 0 8px 20px rgba(0, 102, 255, 0.4);
      transform: translateY(-2px);
    }

    /* Submission details */
    .submission-details {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      background: rgba(0, 0, 0, 0.2);
      border-left: 4px solid var(--secondary);
    }

    .submission-header {
      font-size: 1.1rem;
      margin-bottom: 10px;
      color: var(--light);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .modal-grade-display {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .modal-grade-value {
      font-family: 'Montserrat', sans-serif;
      font-size: 1.8rem;
      font-weight: 800;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.3);
    }

    .feedback {
      margin-top: 10px;
      padding: 10px;
      background: rgba(0, 0, 0, 0.1);
      border-radius: 6px;
      font-style: italic;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: rgba(240, 246, 255, 0.6);
      grid-column: 1 / -1;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .empty-state i {
      font-size: 3rem;
      margin-bottom: 15px;
      opacity: 0.5;
    }

    .empty-state p {
      font-size: 1.1rem;
      margin-bottom: 10px;
    }

    /* Loading State */
    .loading-state {
      text-align: center;
      padding: 40px 20px;
      grid-column: 1 / -1;
      display: none;
    }

    .spinner {
      border: 4px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      border-top: 4px solid var(--secondary);
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Bottom Navigation - Mobile */
    .bottom-nav {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: rgba(10, 17, 40, 0.95);
      backdrop-filter: blur(10px);
      display: flex;
      justify-content: space-around;
      padding: 10px 0;
      border-top: 1px solid rgba(0, 204, 255, 0.2);
      z-index: 1000;
      display: none;
    }

    .nav-btn {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-decoration: none;
      color: rgba(240, 246, 255, 0.7);
      font-size: 0.8rem;
      padding: 8px 12px;
      border-radius: 10px;
      transition: var(--transition);
    }

    .nav-btn i {
      font-size: 1.2rem;
      margin-bottom: 4px;
    }

    .nav-btn.active {
      color: var(--secondary);
      background: rgba(0, 204, 255, 0.1);
    }

    /* Toggle Button */
    .menu-toggle {
      display: none;
      background: none;
      border: none;
      color: var(--light);
      font-size: 1.5rem;
      cursor: pointer;
    }

    /* Responsive Design */
    @media (max-width: 992px) {
      .quizzes-container, .stats-container {
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      }
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        width: 80%;
        max-width: 300px;
      }
      
      .sidebar.active {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
        padding-bottom: calc(var(--bottom-nav-height) + 20px);
      }
      
      .bottom-nav {
        display: flex;
      }
      
      .header {
        padding: 15px;
      }
      
      .welcome-section h1 {
        font-size: 1.3rem;
      }
      
      .menu-toggle {
        display: block;
      }
      
      .quizzes-container, .stats-container {
        grid-template-columns: 1fr;
      }

      .exam-container {
        width: 95%;
        padding: 15px;
      }
      
      .grade-value {
        font-size: 1.3rem;
      }

      .timer-container {
        top: 10px;
        right: 10px;
        padding: 10px;
        min-width: 120px;
      }
      
      .timer-display {
        font-size: 1.5rem;
      }
    }

                   .profile-img {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--gradient);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 26px;
      transition: transform 0.2s ease;
    }

    .profile-img:hover {
      transform: scale(1.1);
    }

    /* Balls */
    .ball {
      position: absolute;
      width: 45px;
      height: 45px;
      border-radius: 50%;
      background: #007bff;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      text-decoration: none;
      opacity: 0;
      transform: translate(0, 0);
      transition: transform 0.6s ease, opacity 0.4s ease;
      pointer-events: none;
    }

    .ball.logout {
      background: #e74c3c;
    }

    .ball.profile {
      background: #2ecc71;
    }

    /* Active (thrown out) state */
    .user-profile.active .ball.logout {
      transform: translate(-60px, 30px);
      opacity: 1;
      pointer-events: auto;
    }

    .user-profile.active .ball.profile {
      transform: translate(-60px, -30px);
      opacity: 1;
      pointer-events: auto;
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <!-- Overlay for mobile -->
    <div class="overlay" id="overlay"></div>

    <!-- Timer Container - FIXED POSITION -->
    <div class="timer-container" id="timerContainer">
      <div class="timer-title">Time Remaining:</div>
      <div class="timer-display timer-normal" id="timerDisplay">20:00</div>
    </div>

    <!-- Sidebar -->
        <aside class="sidebar" id="sidebar" >
            <div class="sidebar-header">
                <a href="../../index.html" class="sidebar-logo">
                    <i class="fas fa-code"></i>
                    CS-<span>IslamHatem</span>
                </a>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="Student-Dashboard.html" class="nav-link">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="available-courses.html" class="nav-link">
                        <i class="fas fa-graduation-cap"></i>
                        <span>Available Course Packages</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="available-lessons.html" class="nav-link">
                        <i class="fas fa-book-open"></i>
                        <span>Available Lessons</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="my-learning.html" class="nav-link">
                        <i class="fas fa-tasks"></i>
                        <span>My Learning</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="my-assignments.html" class="nav-link">
                        <i class="fas fa-clipboard-list"></i>
                        <span>My Assignments</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="user-quizzes.html" class="nav-link active">
                        <i class="fas fa-question-circle"></i>
                        <span>My Quizzes</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="student-streams.html" class="nav-link">
                        <i class="fas fa-video"></i>
                        <span>Online Meetings</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="student-profile.html" class="nav-link">
                        <i class="fas fa-user"></i>
                        <span>Profile</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="student-helpCenter.html" class="nav-link">
                        <i class="fas fa-life-ring"></i>
                        <span>Help Center</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="compiler.html" class="nav-link">
                        <i class="fas fa-code"></i>
                        <span>Compiler</span>
                    </a>
                </li>
            </ul>
        </aside>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Header -->
      <div class="header">
        <div class="welcome-section">
          <h1>My Quizzes</h1>
          <p>Track and complete your quizzes</p>
        </div>
        <button class="menu-toggle" id="menuToggle">
          <i class="fas fa-bars"></i>
        </button>
         <div class="user-profile" id="userMenu">
    <div class="profile-img">
      <i class="fas fa-user"></i>
    </div>
    <a href="student-profile.html" class="ball profile">Profile</a>
    <a onclick="logout()" class="ball logout">Logout</a>
  </div>
            </div>

      <!-- Page Title -->
      <div>
        <h2 class="page-title">My Quizzes</h2>
        <p class="page-subtitle">Stay on top of your coursework with these quizzes</p>
      </div>

      <!-- Stats Overview -->
      <div class="stats-container">
        <div class="stat-card">
          <div class="stat-number stat-pending" id="pending-count">0</div>
          <div class="stat-label">Pending Quizzes</div>
        </div>
        <div class="stat-card">
          <div class="stat-number stat-completed" id="completed-count">0</div>
          <div class="stat-label">Submitted</div>
        </div>
        <div class="stat-card">
          <div class="stat-number stat-graded" id="graded-count">0</div>
          <div class="stat-label">Graded</div>
        </div>
      </div>
      
      <!-- Progress Overview -->
      <div class="progress-container">
        <div class="progress-info">
          <span>Your Progress</span>
          <span id="progress-percentage">0%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
        </div>
      </div>

      <!-- User Quizzes Page -->
      <div id="user-quizzes" class="page active">
        <div id="quizList" class="quizzes-container">
          <div class="loading-state" id="loadingState">
            <div class="spinner"></div>
            <p>Loading your quizzes...</p>
          </div>
        </div>
      </div>
    </main>

    <!-- Bottom Navigation - Mobile -->
        <nav class="bottom-nav">
            <a href="Student-Dashboard.html" class="nav-btn">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="available-courses.html" class="nav-btn" >
                <i class="fas fa-graduation-cap"></i>
                <span>Courses</span>
            </a>
            <a href="my-learning.html" class="nav-btn">
                <i class="fas fa-book-open"></i>
                <span>Lessons</span>
            </a>
            <a href="student-profile.html" class="nav-btn">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </a>
        </nav>

    <!-- Exam Modal -->
    <div class="exam-modal" id="examModal">
      <div class="exam-container">
        <button class="close-exam" id="closeExam">
          <i class="fas fa-times"></i>
        </button>
        
        <div class="exam-header">
          <h2 class="exam-title" id="modalQuizTitle">Quiz Title</h2>
        </div>
        
        <!-- Structured Quiz Content -->
        <div id="modalStructuredQuiz" style="display: none;">
          <div class="structured-container">
            <form id="quizForm"></form>
            <button class="btn-submit" id="submitQuizBtn">Submit Answers</button>
            <p id="status" class="status"></p>
          </div>
        </div>
        
        <!-- PDF Quiz Content -->
        <div id="modalPdfQuiz" style="display: none;">
          <div class="pdf-container">
            <p id="pdfQuizDescription"></p>
            <p><strong>Duration:</strong> <span id="pdfQuizDuration"></span> minutes</p>

            <h3>Exam PDF:</h3>
            <p id="noPDF" style="color:#f87171; display:none;">⚠ No exam PDF available for this quiz.</p>
            <a id="downloadLink" class="download-btn" href="#" download style="display:none;">
              <i class="fas fa-download"></i> Download Exam PDF
            </a>

            <!-- Upload form -->
            <form id="answerUploadForm" class="submission-form">
              <div class="form-group">
                <label class="form-label" for="answerFile">Upload Your Answer (PDF):</label>
                <input type="file" id="answerFile" name="answer" accept="application/pdf" required />
              </div>
              <button type="submit" class="btn-pdf-upload">
                <i class="fas fa-upload"></i> Upload Answer
              </button>
            </form>
            <p id="uploadStatus" class="status"></p>
          </div>
        </div>
        
        <!-- Grade Display -->
        <div id="gradeDisplay" class="submission-details" style="display: none;">
          <div class="submission-header">
            <i class="fas fa-check-circle"></i>
            <span>Your Results</span>
          </div>
          <div class="modal-grade-display">
            <span class="modal-grade-value" id="modalGradeValue">-</span>
          </div>
          <div class="feedback">
            <strong>Feedback:</strong><br>
            <span id="feedbackText">No feedback available.</span>
          </div>
        </div>
      </div>
    </div>
  </div>
<script>
   const userMenu = document.getElementById("userMenu");
                function logout() {
      localStorage.removeItem("token");
      localStorage.removeItem("userInfo");
      window.location.href = "../Login-Pages/login.html";
    }

    userMenu.addEventListener("click", () => {
      userMenu.classList.toggle("active");
    });
</script>
  <script>



    // Global variables
    const BASE_URL = "http://localhost:3000/api/users";
    let currentQuizId = null;
    let currentQuiz = null;
    let quizzes = [];
    let pendingCount = 0;
    let completedCount = 0;
    let gradedCount = 0;
    let timerInterval = null;
    let timeRemaining = 0;
    let quizStarted = false;

    // Initialize the application
    document.addEventListener('DOMContentLoaded', function() {
      // Check authentication
      const token = localStorage.getItem("token");
      if (!token) {
        alert("You need to log in to view your quizzes");
        window.location.href = 'login.html';
        return;
      }

      // Mobile menu functionality
      const overlay = document.getElementById('overlay');
      const sidebar = document.getElementById('sidebar');
      const menuToggle = document.getElementById('menuToggle');
      const closeExamBtn = document.getElementById('closeExam');
      const examModal = document.getElementById('examModal');
      const submitQuizBtn = document.getElementById('submitQuizBtn');
      const loadingState = document.getElementById('loadingState');
      
      // Show loading state initially
      loadingState.style.display = 'flex';
      
      // Mobile menu toggle
      menuToggle.addEventListener('click', function() {
        sidebar.classList.toggle('active');
        overlay.style.display = sidebar.classList.contains('active') ? 'block' : 'none';
      });
      
      // Close sidebar when clicking on overlay
      overlay.addEventListener('click', function() {
        sidebar.classList.remove('active');
        overlay.style.display = 'none';
      });
      
      // Close exam modal
      closeExamBtn.addEventListener('click', function() {
        closeExamModal();
      });
      
      // Submit quiz button
      submitQuizBtn.addEventListener('click', function() {
        submitAnswers();
      });
      
      // Handle window resize
      window.addEventListener('resize', function() {
        if (window.innerWidth > 768) {
          sidebar.classList.remove('active');
          overlay.style.display = 'none';
        }
      });

      // Load quizzes
      loadQuizzes();
    });

    // Auth helper
    const authHeader = () => ({ "Authorization": "Bearer " + (localStorage.getItem("token") || "") });

    // Update quiz statistics
    function updateQuizStats() {
      pendingCount = 0;
      completedCount = 0;
      gradedCount = 0;
      
      quizzes.forEach(quiz => {
        // Check if user has an attempt for this quiz
        if (quiz.attempted && quiz.submittedAt) {
          // Check if the quiz has been reviewed (based on your QuizAttempt model)
          if (quiz.reviewedAt) {
            gradedCount++;
          } 
          // Check if the quiz has been submitted but not reviewed
          else if (quiz.attempted && quiz.submittedAt) {
            completedCount++;
          } else {
            pendingCount++;
          }
        } else {
          pendingCount++;
        }
      });
      
      // Update the UI
      document.getElementById('pending-count').textContent = pendingCount;
      document.getElementById('completed-count').textContent = completedCount;
      document.getElementById('graded-count').textContent = gradedCount;
      
      // Update progress bar
      const totalQuizzes = quizzes.length;
      const completedAndGraded = completedCount + gradedCount;
      const progressPercentage = totalQuizzes > 0 ? Math.round((completedAndGraded / totalQuizzes) * 100) : 0;
      
      document.getElementById('progress-percentage').textContent = `${progressPercentage}%`;
      document.getElementById('progress-fill').style.width = `${progressPercentage}%`;
    }

    // Get grade class based on score
    function getGradeClass(score, maxScore) {
      if (score === "N/A" || score === null || score === undefined) return "grade-na";
      
      const numericScore = parseFloat(score);
      const numericMax = parseFloat(maxScore);
      
      if (isNaN(numericScore) || isNaN(numericMax) || numericMax === 0) return "grade-na";
      
      const percentage = (numericScore / numericMax) * 100;
      
      if (percentage >= 80) return "grade-high";
      if (percentage >= 50) return "grade-medium";
      return "grade-low";
    }

    // Format score display
    function formatScoreDisplay(score, maxScore) {
      if (score === "N/A" || score === null || score === undefined) return "N/A";
      if (maxScore === "N/A" || maxScore === null || maxScore === undefined) return `${score}`;
      
      const numericScore = parseFloat(score);
      const numericMax = parseFloat(maxScore);
      
      if (isNaN(numericScore) || isNaN(numericMax)) return "N/A";
      
      return `${score}/${maxScore}`;
    }

    // Start the quiz timer
    function startTimer(duration) {
      console.log("Starting timer with duration:", duration, "minutes");
      
      // Clear any existing timer
      if (timerInterval) {
        clearInterval(timerInterval);
      }
      
      timeRemaining = duration * 60; // Convert minutes to seconds
      quizStarted = true;
      
      // Show timer
      const timerContainer = document.getElementById('timerContainer');
      const timerDisplay = document.getElementById('timerDisplay');
      
      // Make sure timer is visible and on top
      timerContainer.style.display = 'block';
      timerContainer.style.zIndex = '2000';
      
      // Update timer immediately
      updateTimerDisplay();
      
      // Set up interval to update timer every second
      timerInterval = setInterval(function() {
        timeRemaining--;
        
        if (timeRemaining <= 0) {
          // Time's up!
          clearInterval(timerInterval);
          timerDisplay.textContent = "00:00";
          timerDisplay.className = "timer-display timer-danger";
          
          // Auto-submit the quiz
          if (currentQuiz && currentQuiz.type === "structured") {
            alert("Time's up! Submitting your answers...");
            submitAnswers();
          } else {
            alert("Time's up! Your quiz has been closed.");
            closeExamModal();
          }
        } else {
          updateTimerDisplay();
        }
      }, 1000);
    }
    
    // Update timer display
    function updateTimerDisplay() {
      const timerDisplay = document.getElementById('timerDisplay');
      const minutes = Math.floor(timeRemaining / 60);
      const seconds = timeRemaining % 60;
      
      timerDisplay.textContent = `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
      
      // Change color based on remaining time
      if (timeRemaining < 60) {
        timerDisplay.className = "timer-display timer-danger";
      } else if (timeRemaining < 300) {
        timerDisplay.className = "timer-display timer-warning";
      } else {
        timerDisplay.className = "timer-display timer-normal";
      }
    }
    
    // Stop the timer
    function stopTimer() {
      if (timerInterval) {
        clearInterval(timerInterval);
        timerInterval = null;
      }
      
      // Hide timer
      document.getElementById('timerContainer').style.display = 'none';
      quizStarted = false;
    }

    // User Quizzes functions
    function quizIdOf(q) { return q.quizId || q._id || q.id; }
    function quizTypeOf(q) { return q.examType || q.type || "structured"; }

    async function loadQuizzes() {
      const container = document.getElementById("quizList");
      const loadingState = document.getElementById('loadingState');
      
      try {
        const res = await fetch(`${BASE_URL}/quizzes/my`, { headers: authHeader() });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const payload = await res.json();
        quizzes = payload.quizzes || payload.data || [];

        // Hide loading state
        loadingState.style.display = 'none';

        container.innerHTML = "";
        if (quizzes.length === 0) {
          container.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-clipboard-list"></i>
              <p>No quizzes available.</p>
              <p>New quizzes will appear here when assigned by your instructor.</p>
            </div>
          `;
          return;
        }

        // Update stats
        updateQuizStats();

        quizzes.forEach(q => {
          const id = quizIdOf(q);
          const type = quizTypeOf(q);
          
          // Determine status based on the QuizAttempt model structure
          let statusClass, statusText;

          if (q.reviewedAt) {
            statusClass = 'status-graded';
            statusText = 'Graded';
          } 
          else if (q.attempted && q.submittedAt) {
            statusClass = 'status-completed';
            statusText = 'Submitted';
          } 
          else if (q.attempted) {
            statusClass = 'status-pending';
            statusText = 'In Progress';
          } 
          else {
            statusClass = 'status-pending';
            statusText = 'Not Started';
          }

          // Get grade class for styling
          const gradeClass = getGradeClass(q.score, q.totalMarks);
          const scoreDisplay = formatScoreDisplay(q.score, q.totalMarks);
          
          const card = document.createElement("div");
          card.className = "quiz-card";
          card.innerHTML = `
            <div class="quiz-header">
              <h3 class="quiz-title">${q.title || "Untitled Quiz"}</h3>
              <span class="status-badge ${statusClass}">${statusText}</span>
            </div>
            
            <div class="quiz-desc">${q.description || "No description provided."}</div>
            
            <div class="quiz-meta">
              <div class="meta-item">
                <i class="fas fa-${type === 'structured' ? 'pen-alt' : 'file-pdf'}"></i>
                Type: ${type.toUpperCase()}
              </div>
              <div class="meta-item">
                <i class="fas fa-clock"></i>
                Duration: ${q.duration || 0} min
              </div>
              <div class="meta-item">
                <i class="fas fa-star"></i>
                Total: ${q.totalMarks ?? "-"} marks
              </div>
            </div>
            
            <div style="margin-top: 15px;">
  ${
    q.reviewedAt || (q.attempted && q.submittedAt)
      ? `<button class="btn btn-primary" onclick="viewQuizResults('${encodeURIComponent(q.quizId)}')">
          <i class="fas fa-chart-bar"></i> View Results
         </button>`
      : q.attempted
        ? `<button class="btn btn-secondary" onclick="continueQuiz('${encodeURIComponent(q.quizId)}')">
            <i class="fas fa-play-circle"></i> Continue Quiz
           </button>`
        : q.type === "structured"
          ? `<button class="btn btn-primary" onclick="openStructuredQuiz('${encodeURIComponent(q.quizId)}')">
              <i class="fas fa-play-circle"></i> Start Quiz
             </button>`
          : `<button class="btn btn-secondary" onclick="openPdfQuiz('${encodeURIComponent(q.quizId)}')">
              <i class="fas fa-upload"></i> Upload Answers
             </button>`
  }
</div>

${q.reviewedAt ? `
  <div class="grade-display ${gradeClass}">
    <div class="grade-value">${scoreDisplay}</div>
    <div class="grade-label">Final Score</div>
  </div>
` : ''}

          `;
          container.appendChild(card);
        });
      } catch (err) {
        console.error("Failed to load quizzes:", err);
        loadingState.style.display = 'none';
        container.innerHTML = `
          <div class="empty-state">
            <i class="fas fa-exclamation-circle"></i>
            <p>Error loading quizzes. Please try again.</p>
            <button class="btn btn-primary" onclick="loadQuizzes()" style="margin-top: 15px;">Retry</button>
          </div>
        `;
      }
    }

    function openStructuredQuiz(id) {
      if (!id) return alert("Invalid quiz id");
      currentQuizId = id;
      loadStructuredQuiz();
    }

    function openPdfQuiz(id) {
      if (!id) return alert("Invalid quiz id");
      currentQuizId = id;
      loadPdfQuiz();
    }

    function continueQuiz(id) {
      if (!id) return alert("Invalid quiz id");
      currentQuizId = id;
      
      // Find the quiz
      const quiz = quizzes.find(q => quizIdOf(q) === id);
      if (!quiz) return alert("Quiz not found");
      
      if (quiz.type === "structured") {
        loadStructuredQuiz();
      } else {
        loadPdfQuiz();
      }
    }

    function viewQuizResults(id) {
      if (!id) return alert("Invalid quiz id");
      currentQuizId = id;
      showQuizResults();
    }

    // Open exam modal
    function openExamModal() {
      const examModal = document.getElementById('examModal');
      examModal.classList.add('active');
      document.body.style.overflow = 'hidden'; // Prevent scrolling
    }

    // Close exam modal
    function closeExamModal() {
      const examModal = document.getElementById('examModal');
      examModal.classList.remove('active');
      document.body.style.overflow = ''; // Enable scrolling
      
      // Stop the timer
      stopTimer();
      
      // Reload quizzes to update status
      loadQuizzes();
    }

    // Structured Quiz functions
    async function loadStructuredQuiz() {
      const token = localStorage.getItem("token");
      
      try {
        // Fetch quiz info
        const res = await fetch(`${BASE_URL}/quizzes/${currentQuizId}`, {
          headers: { Authorization: `Bearer ${token}` }
        });
        if (!res.ok) throw new Error("Failed to fetch quiz");

        currentQuiz = await res.json();
        document.getElementById("modalQuizTitle").textContent = currentQuiz.title || "Structured Quiz";

        // Show structured quiz, hide PDF quiz
        document.getElementById("modalStructuredQuiz").style.display = "block";
        document.getElementById("modalPdfQuiz").style.display = "none";
        document.getElementById("gradeDisplay").style.display = "none";

        const form = document.getElementById("quizForm");
        form.innerHTML = "";

        // Fetch user's attempt
        let attempt = null;
        try {
          const attemptRes = await fetch(`${BASE_URL}/${currentQuizId}/attempt`, {
            headers: { Authorization: `Bearer ${token}` }
          });
          if (attemptRes.ok) {
            const attemptData = await attemptRes.json();
            attempt = attemptData.attempt;
          }
        } catch (err) {
          console.log("No attempt found or error fetching attempt:", err);
        }

        // If quiz is already submitted and graded, show results
        if (attempt && (attempt.status === "reviewed" || attempt.reviewedAt)) {
          showQuizResults();
          return;
        }

        // Start the timer (always start a new timer when opening a quiz)
        const quizDuration = currentQuiz.duration || 20;
        console.log("Starting timer for quiz duration:", quizDuration);
        startTimer(quizDuration);

        currentQuiz.questions.forEach((q, i) => {
          const div = document.createElement("div");
          div.className = "question";

          let userAnswer = "";
          let marksObtained = 0;
          let isReviewed = false;

          if (attempt) {
            const ansObj = attempt.answers.find(a => a.question && a.question.toString() === q._id);
            if (ansObj) {
              userAnswer = ansObj.answer || "";
              marksObtained = ansObj.marksObtained || 0;
              isReviewed = attempt.status === "reviewed" || attempt.reviewedAt;
            }
          }

          if (q.type === "mcq") {
            div.innerHTML = `
              <label>Q${i + 1}: ${q.text}</label>
              <div class="options">
                ${q.options.map(opt => `
                  <label>
                    <input type="radio" name="q${i}" value="${opt}" 
                      ${opt === userAnswer ? "checked" : ""} 
                      ${isReviewed ? "disabled" : ""}>
                    ${opt}
                  </label>
                `).join("")}
              </div>
            `;
          } else {
            div.innerHTML = `
              <label>Q${i + 1}: ${q.text}</label>
              <textarea name="q${i}" placeholder="Your answer here" ${isReviewed ? "disabled" : ""}>${userAnswer}</textarea>
            `;
          }

          if (isReviewed) {
            const scoreDiv = document.createElement("div");
            scoreDiv.innerHTML = `<strong>Marks Obtained:</strong> ${marksObtained}`;
            scoreDiv.style.marginTop = "5px";
            div.appendChild(scoreDiv);
          }

          form.appendChild(div);
        });

        // Show total score if reviewed
        const statusEl = document.getElementById("status");
        if (attempt) {
          if (attempt.status === "reviewed" || attempt.reviewedAt) {
            statusEl.innerHTML = `✅ Total Score: <strong>${attempt.score || 0}</strong>`;
          } else {
            statusEl.textContent = "⚠ Your submission is pending grading";
          }
        } else {
          statusEl.textContent = "";
        }

        // Open the modal
        openExamModal();

      } catch (err) {
        console.error("Error loading quiz:", err);
        document.getElementById("modalQuizTitle").textContent = "❌ Error loading quiz";
      }
    }

    async function submitAnswers() {
      const token = localStorage.getItem("token");
      if (!currentQuiz || !currentQuiz.questions) return;

      const answers = currentQuiz.questions.map((q, i) => {
        let value = "";
        if (q.type === "mcq") {
          const selected = document.querySelector(`input[name="q${i}"]:checked`);
          value = selected ? selected.value : "";
        } else {
          const textarea = document.querySelector(`textarea[name="q${i}"]`);
          value = textarea ? textarea.value : "";
        }
        return { questionId: q._id, answer: value };
      });

      try {
        const res = await fetch(`${BASE_URL}/quizzes/${currentQuizId}/submit`, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            Authorization: `Bearer ${token}`
          },
          body: JSON.stringify({ answers })
        });

        const data = await res.json();
        const statusEl = document.getElementById("status");
        if (!res.ok) throw new Error(data.error || "Submission failed");

        statusEl.textContent = "✅ Answers submitted successfully!";
        
        // Stop the timer
        stopTimer();

        // Show success message for 2 seconds then close modal
        setTimeout(() => {
          closeExamModal();
        }, 2000);

      } catch (err) {
        document.getElementById("status").textContent = "❌ Submission failed: " + err.message;
        console.error("Submit error:", err);
      }
    }

    // PDF Quiz functions
    async function loadPdfQuiz() {
      const token = localStorage.getItem("token");
      
      try {
        // Fetch quiz info
        const res = await fetch(`${BASE_URL}/quizzes/${currentQuizId}`, {
          headers: { Authorization: `Bearer ${token}` }
        });
        if (!res.ok) throw new Error("Failed to fetch quiz");
        const quiz = await res.json();

        document.getElementById("modalQuizTitle").textContent = quiz.title;
        document.getElementById("pdfQuizDescription").textContent = quiz.description;
        document.getElementById("pdfQuizDuration").textContent = quiz.duration || "N/A";

        // Show PDF quiz, hide structured quiz
        document.getElementById("modalStructuredQuiz").style.display = "none";
        document.getElementById("modalPdfQuiz").style.display = "block";
        document.getElementById("gradeDisplay").style.display = "none";

        if (quiz.pdfFile) {
          const pdfUrl = `http://localhost:3000/${quiz.pdfFile.replace(/\\/g, "/")}`;
          const downloadLink = document.getElementById("downloadLink");
          downloadLink.href = pdfUrl;
          downloadLink.style.display = "inline-block";
          document.getElementById("noPDF").style.display = "none";
        } else {
          document.getElementById("noPDF").style.display = "block";
          document.getElementById("downloadLink").style.display = "none";
        }

        // Fetch user's attempt for this quiz
        let attempt = null;
        try {
          const attemptRes = await fetch(`${BASE_URL}/${currentQuizId}/attempt`, {
            headers: { Authorization: `Bearer ${token}` }
          });
          if (attemptRes.ok) {
            const attemptData = await attemptRes.json();
            attempt = attemptData.attempt;
          }
        } catch (err) {
          console.log("No attempt found or error fetching attempt:", err);
        }

        const uploadStatus = document.getElementById("uploadStatus");

        if (attempt) {
          if (attempt.status === "reviewed" || attempt.reviewedAt) {
            // Show results instead of upload form
            showQuizResults();
            return;
          } else if (attempt.submittedAt) {
            uploadStatus.textContent = "⚠ Your submission is pending grading";
          }
        } else {
          uploadStatus.textContent = "";
        }

        // Start the timer for PDF quiz (if not already submitted)
        if (!attempt || !attempt.submittedAt) {
          const quizDuration = quiz.duration || 20;
          console.log("Starting timer for PDF quiz duration:", quizDuration);
          startTimer(quizDuration);
        }

        // Open the modal
        openExamModal();

      } catch (err) {
        document.getElementById("modalQuizTitle").textContent = "Error loading quiz";
        console.error("Error loading quiz:", err);
      }
    }

    async function uploadPdfAnswer() {
      const file = document.getElementById("answerFile").files[0];
      if (!file) {
        alert("Please select a file first.");
        return;
      }

      const token = localStorage.getItem("token");
      const formData = new FormData();
      formData.append("answer", file);

      try {
        const res = await fetch(`${BASE_URL}/quizzes/${currentQuizId}/upload`, {
          method: "POST",
          headers: { Authorization: `Bearer ${token}` },
          body: formData
        });

        const data = await res.json();
        if (res.ok) {
          document.getElementById("uploadStatus").textContent = "✅ Answer uploaded successfully!";
          
          // Stop the timer
          stopTimer();
          
          // Show success message for 2 seconds then close modal
          setTimeout(() => {
            closeExamModal();
          }, 2000);
        } else {
          document.getElementById("uploadStatus").textContent = "⚠ Upload failed: " + (data.error || "Unknown error");
        }
      } catch (err) {
        document.getElementById("uploadStatus").textContent = "❌ Upload error: " + err.message;
        console.error("Upload error:", err);
      }
    }

    // Show quiz results
    async function showQuizResults() {
      const token = localStorage.getItem("token");
      
      try {
        // Fetch quiz info
        const res = await fetch(`${BASE_URL}/quizzes/${currentQuizId}`, {
          headers: { Authorization: `Bearer ${token}` }
        });
        if (!res.ok) throw new Error("Failed to fetch quiz");
        currentQuiz = await res.json();
        
        // Fetch user's attempt
        const attemptRes = await fetch(`${BASE_URL}/${currentQuizId}/attempt`, {
          headers: { Authorization: `Bearer ${token}` }
        });
        const attemptData = await attemptRes.json();
        const attempt = attemptData.attempt;

        if (attempt && (attempt.status === "reviewed" || attempt.reviewedAt)) {
          document.getElementById("modalQuizTitle").textContent = currentQuiz.title || "Quiz Results";
          
          // Format the grade display
          const scoreDisplay = formatScoreDisplay(attempt.score, currentQuiz.totalMarks);
          const gradeClass = getGradeClass(attempt.score, currentQuiz.totalMarks);
          
          document.getElementById("modalGradeValue").textContent = scoreDisplay;
          document.getElementById("modalGradeValue").className = `modal-grade-value ${gradeClass}`;
          document.getElementById("feedbackText").textContent = attempt.feedback || "No feedback provided.";
          
          // Show results, hide quiz forms
          document.getElementById("modalStructuredQuiz").style.display = "none";
          document.getElementById("modalPdfQuiz").style.display = "none";
          document.getElementById("gradeDisplay").style.display = "block";
          
          // Open the modal
          openExamModal();
        } else {
          alert("Results are not available yet. Your submission is still being graded.");
        }
      } catch (err) {
        console.error("Error fetching results:", err);
        alert("Error loading results. Please try again.");
      }
    }
  </script>
</body>
</html>